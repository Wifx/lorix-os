#@TYPE: Machine
#@Name: WIFX SAMA5D4 LORIX One (512MB NAND version)
#@DESCRIPTION: Machine configuration for Wifx LoRa gateway board - LORIX One

# The LORIX One base
require include/lorix-one-base.inc

# Uncomment the following line to generate a SD card image
# MACHINE_FEATURES += " sdimg"

KERNEL_DEVICETREE = "lorix-one-512.dtb"
KERNEL_IMAGETYPE = "zImage"

IMAGE_FSTYPES += " ubimg wimg tar.bz2"

# Wifx archive image parameters
WIMG_DEVICE_NAND_HEADER = "0xc1e04e07"
WIMG_DEVICE_ERASE_BLK = "0x40000"

# NAND
MKUBIFS_ARGS ?= " -e 0x3e000 -c 4096 -m 0x1000 -x lzo"
UBINIZE_ARGS ?= " -m 0x1000 -p 0x40000 -s 4096"

#UBI_VOLNAME = "rootfs"
UBI_ROOTFS_SIZE_MB = "64"

UBOOT_MACHINE ?= "lorix_one_512_nandflash_config"
UBOOT_ENTRYPOINT = "0x20008000"
UBOOT_LOADADDRESS = "0x20008000"

# Mender section
MENDER_MTDIDS = "nand0=atmel_nand"
MENDER_MTDPARTS = "atmel_nand:256k(bootstrap)ro,768k(uboot)ro,512k(uboot-env),-(ubi)"

MENDER_BOOT_PART_SIZE_MB = "0"
MENDER_RESERVED_SPACE_BOOTLOADER_DATA = "0x180000"

# 512MB of NAND flash minus bootloader area
MENDER_STORAGE_TOTAL_SIZE_MB = "510"
# 300MB for data partition
MENDER_DATA_PART_SIZE_MB = "200"
# align to PEB size 256K
MENDER_STORAGE_PEB_SIZE = "262144"
# Account for UBI overhead, see
# http://www.linux-mtd.infradead.org/doc/ubi.html#L_overhead for details,
MENDER_PARTITIONING_OVERHEAD_KB = "26256"

MENDER_UBOOT_ENV_STORAGE_DEVICE_OFFSET_1 = "0x140000"
MENDER_UBOOT_ENV_STORAGE_DEVICE_OFFSET_2 = "0x100000"
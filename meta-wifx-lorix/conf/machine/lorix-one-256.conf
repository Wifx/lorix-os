#@TYPE: Machine
#@Name: WIFX SAMA5D4 LORIX One (256MB NAND version)
#@DESCRIPTION: Machine configuration for Wifx LoRa gateway board - LORIX One

# The LORIX One base
require include/lorix-one-base.inc

# Uncomment the following line to generate a SD card image
# MACHINE_FEATURES += " sdimg"

# Bad OS package recommendation
BAD_RECOMMENDATIONS = "net-snmp-server"

KERNEL_DEVICETREE = "lorix-one-256.dtb"
KERNEL_IMAGETYPE = "zImage"

IMAGE_FSTYPES += " ubimg wimg"

# Wifx archive image parameters
WIMG_DEVICE_NAND_HEADER = "0xc0902405"
WIMG_DEVICE_ERASE_BLK = "0x20000"

# NAND
MKUBIFS_ARGS ?= " -e 0x1f000 -c 2048 -m 0x800 -x lzo"
UBINIZE_ARGS ?= " -m 0x800 -p 0x20000 -s 2048"

#UBI_VOLNAME = "rootfs"
UBI_ROOTFS_SIZE_MB = "64"

UBOOT_MACHINE ?= "lorix_one_256_nandflash_config"
UBOOT_ENTRYPOINT = "0x20008000"
UBOOT_LOADADDRESS = "0x20008000"

# Mender section
MENDER_MTDIDS = "nand0=atmel_nand"
MENDER_MTDPARTS = "atmel_nand:256k(bootstrap)ro,768k(uboot)ro,512k(uboot-env),-(ubi)"

MENDER_BOOT_PART_SIZE_MB = "0"
MENDER_RESERVED_SPACE_BOOTLOADER_DATA = "0x180000"

# 256MB of NAND flash minus bootloader area and 4 reserved PEBs for bad PEB handling
MENDER_STORAGE_TOTAL_SIZE_MB = "254"
# 57MB for data partition
MENDER_DATA_PART_SIZE_MB = "57"
# align to PEB size 128k
MENDER_STORAGE_PEB_SIZE = "131072"
# Account for UBI overhead, see
# http://www.linux-mtd.infradead.org/doc/ubi.html#L_overhead for details,
MENDER_PARTITIONING_OVERHEAD_KB = "13104"

MENDER_UBOOT_ENV_STORAGE_DEVICE_OFFSET_1 = "0x140000"
MENDER_UBOOT_ENV_STORAGE_DEVICE_OFFSET_2 = "0x100000"